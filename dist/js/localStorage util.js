function checkDataBase(){if(!localStorage.cate||!localStorage.childCate||!localStorage.task){var e=[{id:0,name:"默认分类",child:[0]}],a=[{id:0,pid:0,name:"默认子分类",child:[0,1]}],t=[{id:0,pid:0,finished:!0,name:"使用说明",date:"2017-01-20",content:"这是一个To-Do List，待办事项列表App：\n本应用为离线应用，数据将存储在浏览器的本地\n页面自适应移动端和PC\n\n整个App可分为三栏：\n左栏为文件夹结构的分类列表\n中栏为当前分类下的任务列表\n右栏为任务的内容详情\n\n有 添加删除分类，添加删除任务，修改任务，以及标记任务是否已完成 等功能\n\nby az22c: \nhttps://github.com/AlexZhong22c/ToDo-WebApp\n(color: https://alexzhong22c.github.io/color-design-22c/color-design.html)\n2017年10月"},{id:1,pid:0,finished:!1,name:"随便写写",date:"2017-01-22",content:"随便写写。"}];localStorage.cate=JSON.stringify(e),localStorage.childCate=JSON.stringify(a),localStorage.task=JSON.stringify(t)}}function queryAllCates(){return JSON.parse(localStorage.cate)}function queryAllChildCates(){return JSON.parse(localStorage.childCate)}function queryAllTasks(){return JSON.parse(localStorage.task)}function queryCateById(e){for(var a=JSON.parse(localStorage.cate),t=0;t<a.length;t++)if(a[t].id==e)return a[t]}function queryChildCateById(e){for(var a=JSON.parse(localStorage.childCate),t=0;t<a.length;t++)if(a[t].id==e)return a[t]}function queryChildCatesByIdArray(e){for(var a=[],t=0;t<e.length;t++)a.push(queryChildCateById(e[t]));return a}function queryTaskById(e){for(var a=JSON.parse(localStorage.task),t=0;t<a.length;t++)if(a[t].id==e)return a[t]}function queryTasksByChildCateId(e){JSON.parse(localStorage.task);var a=[],t=queryChildCateById(e);console.log(t);var l=t.child;if(l.length>0)for(var r=0;r<l.length;r++)a.push(queryTaskById(l[r]));return a}function queryTasksByDateInTaskArr(e,a){for(var t=[],l=0;l<a.length;l++)a[l].date==e&&t.push(a[l]);return t}function queryTasksTotalByCateId(e){for(var a=0,t=queryChildCatesByIdArray(queryCateById(e).child),l=0;l<t.length;l++)a+=t[l].child.length;return a}function addCate(e){for(var a=JSON.parse(localStorage.cate),t=[],l=-1,r=0;r<a.length;r++)t.push(a[r].id);t=t.sort(compareNumbers);for(var i=1;i<t.length;i++)if(t[i]-t[i-1]>1){l=t[i-1]+1;break}i==t.length&&(l=t.length);var o={};o.id=l,o.name=e,o.child=[],a.push(o),localStorage.cate=JSON.stringify(a)}function addChildCate(e,a){for(var t=JSON.parse(localStorage.childCate),l=[],r=-1,i=0;i<t.length;i++)l.push(t[i].id);l=l.sort(compareNumbers);for(var o=1;o<l.length;o++)if(l[o]-l[o-1]>1){r=l[o-1]+1;break}o==l.length&&(r=l.length);var n={};n.id=r,n.pid=e,n.name=a,n.child=[],t.push(n),localStorage.childCate=JSON.stringify(t),console.log("addcc:"+localStorage.childCate),updateCateWhenAddChildCate(e,n.id)}function addTask(e){for(var a=JSON.parse(localStorage.task),t=[],l=-1,r=0;r<a.length;r++)t.push(a[r].id);t=t.sort(compareNumbers);for(var i=1;i<t.length;i++)if(t[i]-t[i-1]>1){l=t[i-1]+1;break}return i==t.length&&(l=t.length),e.id=l,a.push(e),localStorage.task=JSON.stringify(a),updateChildCateWhenAddTask(e.pid,e.id),l}function updateCateWhenAddChildCate(e,a){for(var t=JSON.parse(localStorage.cate),l=0;l<t.length;l++)if(t[l].id==e){t[l].child.push(a);break}localStorage.cate=JSON.stringify(t)}function updateChildCateWhenAddTask(e,a){for(var t=JSON.parse(localStorage.childCate),l=0;l<t.length;l++)if(t[l].id==e){t[l].child.push(a);break}localStorage.childCate=JSON.stringify(t)}function updateTask(e){for(var a=JSON.parse(localStorage.task),t=0;t<a.length;t++)a[t].id==e.id&&(0!=currentTaskId&&(a[t].name=e.name),a[t].date=e.date,a[t].content=e.content);localStorage.task=JSON.stringify(a)}function updateTaskStatusById(e,a){a=!!a;for(var t=JSON.parse(localStorage.task),l=0;l<t.length;l++)if(t[l].id==e){t[l].finished=a;break}localStorage.task=JSON.stringify(t)}function updateCateWhenDelChildCate(e,a){console.log("ci:"+e+",cci:"+a);for(var t=JSON.parse(localStorage.cate),l=0;l<t.length;l++)if(t[l].id==e){var r=t[l].child,i=t[l].child.indexOf(a);r=r.slice(0,i).concat(r.slice(i+1)),t[l].child=r,localStorage.cate=JSON.stringify(t);break}}function updateChildCateWhenDelTask(e,a){for(var t=JSON.parse(localStorage.childCate),l=0;l<t.length;l++)if(t[l].id==e){var r=t[l].child,i=t[l].child.indexOf(a);r=r.slice(0,i).concat(r.slice(i+1)),t[l].child=r,localStorage.childCate=JSON.stringify(t);break}}function deleteTaskById(e,a){for(var t=[],l=queryAllTasks(),r=0;r<l.length;r++)l[r].id==e&&(t=l.slice(0,r).concat(l.slice(r+1)));localStorage.task=JSON.stringify(t),updateChildCateWhenDelTask(a,e)}function deleteTaskByIdArr(e){for(var a=queryAllTasks(),t=0;t<e.length;t++)for(var l=0;l<a.length;l++)if(a[l].id==e[t]){a=a.slice(0,l).concat(a.slice(l+1));break}localStorage.task=JSON.stringify(a)}function deleteChildCateById(e){for(var a=[],t=-1,l=[],r=queryAllChildCates(),i=0;i<r.length;i++)r[i].id==e&&(a=r.slice(0,i).concat(r.slice(i+1)),t=r[i].pid,l=r[i].child);localStorage.childCate=JSON.stringify(a),deleteTaskByIdArr(l),updateCateWhenDelChildCate(t,e)}function deleteCateById(e){for(var a=[],t=queryAllCates(),l=0;l<t.length;l++)if(t[l].id==e){a=t.slice(0,l).concat(t.slice(l+1));for(var r=queryChildCatesByIdArray(t[l].child),i=[],o=0;o<r.length;o++)i=i.concat(r[o].child);deleteTaskByIdArr(i),deleteChildCateByIdArr(t[l].child);break}localStorage.cate=JSON.stringify(a)}function deleteChildCateByIdArr(e){for(var a=queryAllChildCates(),t=0;t<e.length;t++)for(var l=0;l<a.length;l++)if(a[l].id==e[t]){a=a.slice(0,l).concat(a.slice(l+1));break}localStorage.childCate=JSON.stringify(a)}function listAllStorage(){console.log("=============listAllStorage==============");for(var e=0;e<localStorage.length;e++){var a=localStorage.key(e),t=localStorage.getItem(a);console.log("name:\n\t"+a),console.log("value:\n\t"+t),console.log("---------------------")}console.log("=============listAllStorage==End=========")}listAllStorage();